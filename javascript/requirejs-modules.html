

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. RequireJS and JavaScript modules &mdash; Mastering Plone 1.2.5a documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
    <link rel="top" title="Mastering Plone 1.2.5a documentation" href="../index.html"/>
        <link rel="up" title="JavaScript for Plone Developers" href="index.html"/>
        <link rel="next" title="4. Mockup - A Patternslib based collection of components" href="mockup.html"/>
        <link rel="prev" title="2. The JavaScript development process in Plone" href="development-process.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Mastering Plone
          

          
          </a>

          
            
            
              <div class="version">
                1.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Mastering Plone</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plone_training_config/instructions.html">3. Installing Plone for the Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anatomy.html">4. The Anatomy of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../case.html">5. The Case Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">6. The Features of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plone5.html">7. What&#8217;s New in Plone 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuring_customizing.html">8. Configuring and Customizing Plone &#8220;Through The Web&#8221;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending.html">9. Extending Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add-ons.html">10. Extend Plone With Add-On Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theming/index.html">11. Mastering Plone 5: Theming</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">JavaScript for Plone Developers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="training_installation.html">1. Installing Plone and example packages for the Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="development-process.html">2. The JavaScript development process in Plone</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">3. RequireJS and JavaScript modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-a-module">Defining a module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-information">More information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mockup.html">4. Mockup - A Patternslib based collection of components</a></li>
<li class="toctree-l2"><a class="reference internal" href="mockup-writing-documentation.html">5. Writing documentation for Mockup</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-3-ttw.html">6. Through-The-Web development</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-scratchpad.html">7. Scratchpad</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dexterity.html">12. Dexterity I: &#8220;Through The Web&#8221;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../buildout_1.html">13. Buildout I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eggs1.html">14. Write Your Own Add-Ons to Customize Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export_code.html">15. Return to Dexterity: Moving contenttypes into Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views_1.html">16. Views I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zpt.html">17. Page Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zpt_2.html">18. Customizing Existing Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views_2.html">19. Views II: A Default View for &#8220;Talk&#8221;</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views_3.html">20. Views III: A Talk List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">21. Testing in Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../behaviors_1.html">22. Behaviors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../viewlets_1.html">23. Writing Viewlets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">24. Programming Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide.html">25. IDEs and Editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dexterity_2.html">26. Dexterity Types II: Growing Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../custom_search.html">27. Custom Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../events.html">28. Turning Talks into Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_generated_content.html">29. User Generated Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">30. Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thirdparty_behaviors.html">31. Using Third-Party Behaviors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dexterity_3.html">32. Dexterity Types III: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../relations.html">33. Relations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registry.html">34. Storing Settings in the Registry and create control-panels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eggs2.html">35. Creating Reusable Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../behaviors_2.html">36. More Complex Behaviors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../viewlets_2.html">37. A Viewlet for the Votable Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reusable.html">38. Making Our Package Reusable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embed.html">39. Using starzel.votable_behavior in ploneconf.site</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_code.html">40. Releasing Your Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_sites.html">41. Buildout II: Getting Ready for Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontpage.html">42. Creating a Dynamic Front Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../future_of_plone.html">43. The Future of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optional.html">44. Optional</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGES.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Mastering Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">JavaScript for Plone Developers</a> &raquo;</li>
      
    <li>3. RequireJS and JavaScript modules</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="requirejs-and-javascript-modules">
<h1>3. RequireJS and JavaScript modules<a class="headerlink" href="#requirejs-and-javascript-modules" title="Permalink to this headline">¶</a></h1>
<p>One of the great new features, Plone 5 gives us, is the ability to define and use JavaScript modules.</p>
<p>Most serious programming languages provide the concept of namespaces and module dependencies, like Python&#8217;s <code class="docutils literal"><span class="pre">import</span></code> mechanism.
Python code would be unmanageable, if we&#8217;d rely on the existence of global variables and objects in our own scripts.</p>
<p>But JavaScript doesn&#8217;t have any concept for declaring dependencies.
Only the new and finalized ECMAScript 6 (ES6) standard finally comes with a module definition system (actually directly inspired by RequireJS and CommonJS), along other great features like proper variable scoping.</p>
<p>In Plone, we use <a class="reference external" href="http://requirejs.org">RequireJS</a> as a framework to define and load modules.
RequireJS is an implementation of the <a class="reference external" href="https://github.com/amdjs/amdjs-api/blob/master/AMD.md">Asynchronous Module Definition API</a>.
The module definition and loading standard of CommonJS is used by NodeJS.
RequireJS adds the ability to load modules asynchronously, which can be better for performance.
The CommonJS module loading syntax can also be used in RequireJS.
But the main point why Plone uses RequireJS is, that there is a JavaScript based compiler, which allows us to build bundles (a combined, optimized and minified form with all dependencies) Through-The-Web.
RequireJS and CommonJS are also forward compatible with ES6&#8217;s module definition standard.</p>
<p>Finally we can use JavaScript in Plone like it is a proper programming language!
No need to depend on the existence of global variables and a strict order, in which scripts have to be loaded.
You can still use legacy-style JavaScript, but Plone encourages you to enter the modern world of JavaScript development.</p>
<div class="section" id="defining-a-module">
<h2>Defining a module<a class="headerlink" href="#defining-a-module" title="Permalink to this headline">¶</a></h2>
<p>In the past years, a common pattern of defining anonymous function calls has evolved.
This allows to better scope variables and not clutter the global namespace.
The pattern is discussed in depth at <a class="reference external" href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html">JavaScript Module Pattern: In-Depth</a> and basically comes down to the following Pattern:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// now have access to globals jQuery (as $) and underscore (as _) in this code.</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">underscore</span><span class="p">));</span>
</pre></div>
</div>
<p>If your code should be reused like a library, you can define a module export.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_module</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">ret</span><span class="p">.</span><span class="nx">my_method</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">underscore</span><span class="p">));</span>
</pre></div>
</div>
<p>RequireJS extends this pattern and removes the necessity for globals to refer to other modules.
In RequireJS, you&#8217;re wrapping your code like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;jquery&quot;</span><span class="p">,</span> <span class="s2">&quot;underscore&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// now have access to jQuery (as $) and underscore (as _), both defined as modules in the RequireJS configuration.</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">ret</span><span class="p">.</span><span class="nx">my_method</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>No need for any globals anymore (except for the <code class="docutils literal"><span class="pre">define</span></code> and <code class="docutils literal"><span class="pre">require</span></code> methods)!</p>
<p>Also note, that the code within the RequireJS define wrapper is exactly the same as in the module pattern example above. Using RequireJS doesn&#8217;t mean, you have to rewrite everything.
It&#8217;s just about modularizing code.</p>
<p>To be able to use the defined module somewhere else, you need to be able to reference it by a module id.
You can pass it as very first argument to the <code class="docutils literal"><span class="pre">define</span></code> function, but you might better do that in the RequireJS configuration.
If you don&#8217;t do it at all, it gets automatically assigned the name of the file.
For example, let&#8217;s assume a project structure like follows and the <code class="docutils literal"><span class="pre">define</span></code> example from above living in a file called <code class="docutils literal"><span class="pre">my_module.js</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>index.html
require.js
my_project/
        |___main.js
        |___app/
              |___/my_module.js
</pre></div>
</div>
<p>Let&#8217;s do the RequireJS configuration in <code class="docutils literal"><span class="pre">main.js</span></code> and use that as main entry point also to finally let something happen:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="nx">baseUrl</span><span class="o">:</span> <span class="s2">&quot;my_project/&quot;</span><span class="p">,</span>
  <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;app&quot;</span><span class="o">:</span> <span class="s2">&quot;app/&quot;</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">require</span><span class="p">([</span><span class="s1">&#39;app/my_module&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">my_module</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">my_module</span><span class="p">.</span><span class="nx">my_method</span><span class="p">();</span>
<span class="p">})</span>
</pre></div>
</div>
<p>You can use your defined module as a dependency in another <code class="docutils literal"><span class="pre">define</span></code> module definition - if you just want to run some non-reusable code - as a dependency in a <code class="docutils literal"><span class="pre">require</span></code> call.
While you have to return a module export in <code class="docutils literal"><span class="pre">define</span></code>, you don&#8217;t need that for <code class="docutils literal"><span class="pre">require</span></code>.
So, <code class="docutils literal"><span class="pre">require</span></code> corresponds to the first form of the module pattern explained above.</p>
<p>When using in the browser (and not in NodeJS, for example), we have to include an entry point as script tag in our HTML markup:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">&quot;require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">&quot;my_module/main.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</div>
<p>Alternatively, you can define a script as main entry point in RequireJS as data attribute on the script tag, which loads require.js.
In that case, you could omit the configuration, because the entry point script is used as <code class="docutils literal"><span class="pre">baseUrl</span></code>, if nothing else is defined:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">data-main=</span><span class="s">&quot;my_project/main.js&quot;</span> <span class="na">src=</span><span class="s">&quot;require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="more-information">
<h2>More information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h2>
<p>More on RequireJS&#8217; API and how to include legacy code, which doesn&#8217;t use the <code class="docutils literal"><span class="pre">define</span></code> module definition pattern, see the <a class="reference external" href="http://requirejs.org/docs/api.html#define">RequireJS API documentation</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mockup.html" class="btn btn-neutral float-right" title="4. Mockup - A Patternslib based collection of components" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="development-process.html" class="btn btn-neutral" title="2. The JavaScript development process in Plone" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The text and illustrations in this website are licensed by the Plone Foundation under a Creative Commons Attribution 4.0 International license..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>