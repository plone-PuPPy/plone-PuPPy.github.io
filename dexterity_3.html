

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>23. Dexterity Types III: Python &mdash; Mastering Plone 1.2.5a documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Mastering Plone 1.2.5a documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Mastering Plone
          

          
          </a>

          
            
            
              <div class="version">
                1.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="simple">
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Mastering Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>23. Dexterity Types III: Python</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dexterity-types-iii-python">
<span id="dexterity3-label"></span><h1>23. Dexterity Types III: Python<a class="headerlink" href="#dexterity-types-iii-python" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Get the code!</p>
<p>Get the code for this chapter (<a class="reference internal" href="sneak.html"><em>More info</em></a>) using this command in the buildout directory:</p>
<div class="last highlight-bash"><div class="highlight"><pre>cp -R src/ploneconf.site_sneak/chapters/13_dexterity_3_p5/ src/ploneconf.site
</pre></div>
</div>
</div>
<p>Without sponsors a conference would be hard to finance plus it is a good opportunity for Plone companies to advertise their services.</p>
<p>In this part we will:</p>
<ul class="simple">
<li>create the content type <em>sponsor</em> that has a python schema</li>
<li>create a viewlet that shows the sponsor logos sorted by sponsoring level</li>
</ul>
<p>The topics we cover are:</p>
<ul class="simple">
<li>python schema for dexterity</li>
<li>schema hint and directives</li>
<li>field permissions</li>
<li>image scales</li>
<li>caching</li>
</ul>
<div class="section" id="the-python-schema">
<h2>The python schema<a class="headerlink" href="#the-python-schema" title="Permalink to this headline">¶</a></h2>
<p>First we create the schema for the new type. Instead of xml we use python now. Create a new folder <code class="docutils literal"><span class="pre">content</span></code> with an empty <code class="docutils literal"><span class="pre">__init__.py</span></code> in it. We don&#8217;t need to register that folder in <code class="docutils literal"><span class="pre">configure.zcml</span></code> since we don&#8217;t need a <code class="docutils literal"><span class="pre">content/configure.zcml</span></code> (at least not yet).</p>
<p>Now add a new file <code class="docutils literal"><span class="pre">content/sponsor.py</span></code>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">plone.app.textfield</span> <span class="kn">import</span> <span class="n">RichText</span>
<span class="kn">from</span> <span class="nn">plone.autoform</span> <span class="kn">import</span> <span class="n">directives</span>
<span class="kn">from</span> <span class="nn">plone.namedfile</span> <span class="kn">import</span> <span class="n">field</span> <span class="k">as</span> <span class="n">namedfile</span>
<span class="kn">from</span> <span class="nn">plone.supermodel</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">plone.supermodel.directives</span> <span class="kn">import</span> <span class="n">fieldset</span>
<span class="kn">from</span> <span class="nn">ploneconf.site</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">z3c.form.browser.radio</span> <span class="kn">import</span> <span class="n">RadioFieldWidget</span>
<span class="kn">from</span> <span class="nn">zope</span> <span class="kn">import</span> <span class="n">schema</span>
<span class="kn">from</span> <span class="nn">zope.schema.vocabulary</span> <span class="kn">import</span> <span class="n">SimpleTerm</span>
<span class="kn">from</span> <span class="nn">zope.schema.vocabulary</span> <span class="kn">import</span> <span class="n">SimpleVocabulary</span>


<span class="n">LevelVocabulary</span> <span class="o">=</span> <span class="n">SimpleVocabulary</span><span class="p">(</span>
    <span class="p">[</span><span class="n">SimpleTerm</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">u&#39;platinum&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Platinum Sponsor&#39;</span><span class="p">)),</span>
     <span class="n">SimpleTerm</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">u&#39;gold&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Gold Sponsor&#39;</span><span class="p">)),</span>
     <span class="n">SimpleTerm</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">u&#39;silver&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Silver Sponsor&#39;</span><span class="p">)),</span>
     <span class="n">SimpleTerm</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">u&#39;bronze&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Bronze Sponsor&#39;</span><span class="p">))]</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">ISponsor</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dexterity Schema for Sponsors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">directives</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">RadioFieldWidget</span><span class="p">)</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Sponsoring Level&#39;</span><span class="p">),</span>
        <span class="n">vocabulary</span><span class="o">=</span><span class="n">LevelVocabulary</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">RichText</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Text&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">URI</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Link&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span>

    <span class="n">fieldset</span><span class="p">(</span><span class="s">&#39;Images&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;logo&#39;</span><span class="p">,</span> <span class="s">&#39;advertisment&#39;</span><span class="p">])</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">namedfile</span><span class="o">.</span><span class="n">NamedBlobImage</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Logo&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">advertisment</span> <span class="o">=</span> <span class="n">namedfile</span><span class="o">.</span><span class="n">NamedBlobImage</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Advertisement (Gold-sponsors and above)&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">directives</span><span class="o">.</span><span class="n">read_permission</span><span class="p">(</span><span class="n">notes</span><span class="o">=</span><span class="s">&#39;cmf.ManagePortal&#39;</span><span class="p">)</span>
    <span class="n">directives</span><span class="o">.</span><span class="n">write_permission</span><span class="p">(</span><span class="n">notes</span><span class="o">=</span><span class="s">&#39;cmf.ManagePortal&#39;</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="n">RichText</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Secret Notes (only for site-admins)&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Some things are notable here:</p>
<ul class="simple">
<li>The fields in the schema are mostly from <code class="docutils literal"><span class="pre">zope.schema</span></code>. A reference of available fields is at <a class="reference external" href="http://docs.plone.org/external/plone.app.dexterity/docs/reference/fields.html">http://docs.plone.org/external/plone.app.dexterity/docs/reference/fields.html</a></li>
<li>In <code class="docutils literal"><span class="pre">directives.widget(level=RadioFieldWidget)</span></code> we change the default widget for a Choice field from a dropdown to radio-boxes. An incomplete reference of available widgets is at <a class="reference external" href="http://docs.plone.org/external/plone.app.dexterity/docs/reference/widgets.html">http://docs.plone.org/external/plone.app.dexterity/docs/reference/widgets.html</a></li>
<li><code class="docutils literal"><span class="pre">LevelVocabulary</span></code> is used to create the options used in the field <code class="docutils literal"><span class="pre">level</span></code>. This way we could easily translate the displayed value.</li>
<li><code class="docutils literal"><span class="pre">fieldset('Images',</span> <span class="pre">fields=['logo',</span> <span class="pre">'advertisment'])</span></code> moves the two image fields to another tab.</li>
<li><code class="docutils literal"><span class="pre">directives.read_permission(...)</span></code> sets the read and write permission for the field <code class="docutils literal"><span class="pre">notes</span></code> to users who can add new members. Usually this permission is only granted to Site Administrators and Managers. We use it to store information that should not be publicly visible. Please note that <code class="docutils literal"><span class="pre">obj.notes</span></code> is still accessible in templates and python. Only using the widget (like we do in the view later) checks for the permission.</li>
<li>We use no grok here</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://docs.plone.org/external/plone.app.dexterity/docs/reference/fields.html#field-types">All available Fields</a></li>
<li><a class="reference external" href="http://docs.plone.org/external/plone.app.dexterity/docs/schema-driven-types.html#schema-driven-types">Schema-driven types with Dexterity</a></li>
<li><a class="reference external" href="http://docs.plone.org/external/plone.app.dexterity/docs/reference/form-schema-hints.html">Form schema hints and directives</a></li>
</ul>
</div>
</div>
<div class="section" id="the-fti">
<h2>The FTI<a class="headerlink" href="#the-fti" title="Permalink to this headline">¶</a></h2>
<p>Second we create the FTI for the new type in <code class="docutils literal"><span class="pre">profiles/default/types/sponsor.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;sponsor&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span> <span class="na">i18n:domain=</span><span class="s">&quot;plone&quot;</span>
   <span class="na">xmlns:i18n=</span><span class="s">&quot;http://xml.zope.org/namespaces/i18n&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Sponsor<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;icon_expr&quot;</span><span class="nt">&gt;</span>string:${portal_url}/document_icon.png<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;factory&quot;</span><span class="nt">&gt;</span>sponsor<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_view_expr&quot;</span><span class="nt">&gt;</span>string:${folder_url}/++add++sponsor<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;link_target&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;immediate_view&quot;</span><span class="nt">&gt;</span>view<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;global_allow&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;filter_content_types&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;allowed_content_types&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;allow_discussion&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default_view&quot;</span><span class="nt">&gt;</span>view<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;view_methods&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;view&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default_view_fallback&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_permission&quot;</span><span class="nt">&gt;</span>cmf.AddPortalContent<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;klass&quot;</span><span class="nt">&gt;</span>plone.dexterity.content.Container<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IDublinCore&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">&gt;</span>ploneconf.site.content.sponsor.ISponsor<span class="nt">&lt;/property&gt;</span>
<span class="hll"> <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;model_source&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span> <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;model_file&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;schema_policy&quot;</span><span class="nt">&gt;</span>dexterity<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;(Default)&quot;</span> <span class="na">to=</span><span class="s">&quot;(dynamic view)&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;edit&quot;</span> <span class="na">to=</span><span class="s">&quot;@@edit&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;sharing&quot;</span> <span class="na">to=</span><span class="s">&quot;@@sharing&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;view&quot;</span> <span class="na">to=</span><span class="s">&quot;(selected layout)&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;action</span> <span class="na">title=</span><span class="s">&quot;View&quot;</span> <span class="na">action_id=</span><span class="s">&quot;view&quot;</span> <span class="na">category=</span><span class="s">&quot;object&quot;</span> <span class="na">condition_expr=</span><span class="s">&quot;&quot;</span>
    <span class="na">description=</span><span class="s">&quot;&quot;</span> <span class="na">icon_expr=</span><span class="s">&quot;&quot;</span> <span class="na">link_target=</span><span class="s">&quot;&quot;</span> <span class="na">url_expr=</span><span class="s">&quot;string:${object_url}&quot;</span>
    <span class="na">visible=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;permission</span> <span class="na">value=</span><span class="s">&quot;View&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/action&gt;</span>
 <span class="nt">&lt;action</span> <span class="na">title=</span><span class="s">&quot;Edit&quot;</span> <span class="na">action_id=</span><span class="s">&quot;edit&quot;</span> <span class="na">category=</span><span class="s">&quot;object&quot;</span> <span class="na">condition_expr=</span><span class="s">&quot;&quot;</span>
    <span class="na">description=</span><span class="s">&quot;&quot;</span> <span class="na">icon_expr=</span><span class="s">&quot;&quot;</span> <span class="na">link_target=</span><span class="s">&quot;&quot;</span>
    <span class="na">url_expr=</span><span class="s">&quot;string:${object_url}/edit&quot;</span> <span class="na">visible=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;permission</span> <span class="na">value=</span><span class="s">&quot;Modify portal content&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Then we register the FTI in <code class="docutils literal"><span class="pre">profiles/default/types.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;portal_types&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Plone Types Tool&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Controls the available contenttypes in your portal<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;talk&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span><span class="nt">/&gt;</span>
<span class="hll"> <span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;sponsor&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span><span class="nt">/&gt;</span>
</span> <span class="c">&lt;!-- -*- more types can be added here -*- --&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>After reinstalling our package we can create the new type.</p>
<div class="section" id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Sponsors are containers but they don&#8217;t have to be. Turn them into items by changing their class to <code class="docutils literal"><span class="pre">plone.dexterity.content.Item</span></code>.</p>
<div class="toggle admonition">
<p class="first admonition-title">Solution</p>
<p>Simply modify the property <code class="docutils literal"><span class="pre">klass</span></code> in the FTI and reinstall.</p>
<div class="last highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;klass&quot;</span><span class="nt">&gt;</span>plone.dexterity.content.Item<span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="the-view">
<h2>The view<a class="headerlink" href="#the-view" title="Permalink to this headline">¶</a></h2>
<p>We use the default view provided by dexterity for testing since we will only display the sponsors in a viewlet and not in their own page.</p>
<p>But we could tweak the default view with some css to make it less ugly. Add the following to <code class="docutils literal"><span class="pre">resources/ploneconf.css</span></code></p>
<div class="highlight-css"><div class="highlight"><pre><span class="nc">.template-view.portaltype-sponsor</span> <span class="nc">.named-image-widget</span> <span class="nt">img</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.template-view.portaltype-sponsor</span> <span class="nt">fieldset</span><span class="nf">#folder-listing</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If we really want a custom view for sponsors it could look like this.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span>
      <span class="na">metal:use-macro=</span><span class="s">&quot;context/main_template/macros/master&quot;</span>
      <span class="na">i18n:domain=</span><span class="s">&quot;ploneconf.site&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;metal:content-core</span> <span class="na">fill-slot=</span><span class="s">&quot;content-core&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">tal:content=</span><span class="s">&quot;structure view/w/level/render&quot;</span><span class="nt">&gt;</span>
      Level
    <span class="nt">&lt;/h3&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">tal:content=</span><span class="s">&quot;structure view/w/text/render&quot;</span><span class="nt">&gt;</span>
      Text
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;newsImageContainer&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">tal:attributes=</span><span class="s">&quot;href context/url&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">tal:condition=</span><span class="s">&quot;python:getattr(context, &#39;logo&#39;, None)&quot;</span>
             <span class="na">tal:attributes=</span><span class="s">&quot;src string:${context/absolute_url}/@@images/logo/preview&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">tal:attributes=</span><span class="s">&quot;href context/url&quot;</span><span class="nt">&gt;</span>
        Website
      <span class="nt">&lt;/a&gt;</span>

      <span class="nt">&lt;img</span> <span class="na">tal:condition=</span><span class="s">&quot;python:getattr(context, &#39;advertisment&#39;, None)&quot;</span>
           <span class="na">tal:attributes=</span><span class="s">&quot;src string:${context/absolute_url}/@@images/advertisment/preview&quot;</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">tal:condition=</span><span class="s">&quot;python: &#39;notes&#39; in view.w&quot;</span>
           <span class="na">tal:content=</span><span class="s">&quot;structure view/w/notes/render&quot;</span><span class="nt">&gt;</span>
        Notes
      <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/metal:content-core&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p class="last">Note how we handle the field with special permissions: <code class="docutils literal"><span class="pre">tal:condition=&quot;python:</span> <span class="pre">'notes'</span> <span class="pre">in</span> <span class="pre">view.w&quot;</span></code> checks if the convenience-dictionary <code class="docutils literal"><span class="pre">w</span></code> provided by the base class <code class="docutils literal"><span class="pre">DefaultView</span></code> holds the widget for the field <code class="docutils literal"><span class="pre">notes</span></code>. If the current user does not have the permission <code class="docutils literal"><span class="pre">cmf.ManagePortal</span></code> it will be omitted from the dictionary and get an error since <code class="docutils literal"><span class="pre">notes</span></code> would not be a key in <code class="docutils literal"><span class="pre">w</span></code>. By first checking if it&#8217;s missing we work around that.</p>
</div>
</div>
<div class="section" id="the-viewlet">
<h2>The viewlet<a class="headerlink" href="#the-viewlet" title="Permalink to this headline">¶</a></h2>
<p>Instead of writing a view you will have to display the sponsors at the bottom of the website in a viewlet.</p>
<p>Register the viewlet in <code class="docutils literal"><span class="pre">browser/configure.zcml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;browser:viewlet</span>
  <span class="na">name=</span><span class="s">&quot;sponsorsviewlet&quot;</span>
  <span class="na">manager=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IPortalFooter&quot;</span>
  <span class="na">for=</span><span class="s">&quot;*&quot;</span>
  <span class="na">layer=</span><span class="s">&quot;..interfaces.IPloneconfSiteLayer&quot;</span>
  <span class="na">class=</span><span class="s">&quot;.viewlets.SponsorsViewlet&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/sponsors_viewlet.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Add the viewlet class in <code class="docutils literal"><span class="pre">browser/viewlets.py</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">plone</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">plone.app.layout.viewlets.common</span> <span class="kn">import</span> <span class="n">ViewletBase</span>
<span class="kn">from</span> <span class="nn">plone.memoize</span> <span class="kn">import</span> <span class="n">ram</span>
<span class="kn">from</span> <span class="nn">ploneconf.site.behaviors.social</span> <span class="kn">import</span> <span class="n">ISocial</span>
<span class="kn">from</span> <span class="nn">ploneconf.site.content.sponsor</span> <span class="kn">import</span> <span class="n">LevelVocabulary</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>


<span class="k">class</span> <span class="nc">SocialViewlet</span><span class="p">(</span><span class="n">ViewletBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">lanyrd_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">adapted</span> <span class="o">=</span> <span class="n">ISocial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adapted</span><span class="o">.</span><span class="n">lanyrd</span>


<span class="k">class</span> <span class="nc">SponsorsViewlet</span><span class="p">(</span><span class="n">ViewletBase</span><span class="p">):</span>

    <span class="nd">@ram.cache</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">time</span><span class="p">()</span> <span class="o">//</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_sponsors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
        <span class="n">brains</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;sponsor&#39;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&#39;images&#39;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
                <span class="n">request</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scales</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="s">&#39;logo&#39;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
                <span class="n">direction</span><span class="o">=</span><span class="s">&#39;down&#39;</span><span class="p">)</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span> <span class="k">if</span> <span class="n">scale</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
                <span class="c"># only display sponsors with a logo</span>
                <span class="k">continue</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">brain</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">brain</span><span class="o">.</span><span class="n">Description</span><span class="p">,</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">(),</span>
                <span class="n">level</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">level</span>
            <span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">sponsors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sponsors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sponsors</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sponsors</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">LevelVocabulary</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="n">level_sponsors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sponsor</span> <span class="ow">in</span> <span class="n">sponsors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="n">sponsor</span><span class="p">[</span><span class="s">&#39;level&#39;</span><span class="p">]:</span>
                    <span class="n">level_sponsors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sponsor</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">level_sponsors</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="n">level_sponsors</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">level_sponsors</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">_sponsors</span></code> returns a list of dictionaries containing all necessary info about sponsors.</li>
<li>We create the complete img tag using a custom scale (200x80) using the view <code class="docutils literal"><span class="pre">images</span></code> from plone.namedfile. This actually scales the logos and saves them as new blobs.</li>
<li>In <code class="docutils literal"><span class="pre">sponsors</span></code> we return a ordered dictionary of randomized lists of dicts (containing the information on sponsors).</li>
</ul>
<p><code class="docutils literal"><span class="pre">_sponsors</span></code> is cached for an hour using <a class="reference external" href="http://docs.plone.org/manage/deploying/testing_tuning/performance/decorators.html#timeout-caches">plone.memoize</a>. This way we don&#8217;t need to keep all sponsor objects in memory all the time. But we&#8217;d have to wait for up to an hour until changes will be visible.</p>
<p>Instead we&#8217;ll cache until one of the sponsors is modified by using a callable <code class="docutils literal"><span class="pre">_sponsors_cachekey</span></code> that returns a number that changes when a sponsor is modified.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="o">...</span>
<span class="k">def</span> <span class="nf">_sponsors_cachekey</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="n">brains</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;sponsor&#39;</span><span class="p">)</span>
    <span class="n">cachekey</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">modified</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">cachekey</span>

<span class="nd">@ram.cache</span><span class="p">(</span><span class="n">_sponsors_cachekey</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_sponsors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://docs.plone.org/manage/deploying/caching/index.html">Guide to Caching</a></li>
<li><a class="reference external" href="http://docs.plone.org/manage/deploying/testing_tuning/performance/decorators.html">Cache decorators</a></li>
<li><a class="reference external" href="http://docs.plone.org/develop/plone/images/content.html#image-scales-plone-4">Image Scaling</a></li>
</ul>
</div>
</div>
<div class="section" id="the-template-for-the-viewlet">
<h2>The template for the viewlet<a class="headerlink" href="#the-template-for-the-viewlet" title="Permalink to this headline">¶</a></h2>
<p>Add the template <code class="docutils literal"><span class="pre">browser/templates/sponsors_viewlet.pt</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">metal:define-macro=</span><span class="s">&quot;portal_sponsorbox&quot;</span>
     <span class="na">i18n:domain=</span><span class="s">&quot;ploneconf.site&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;portal-sponsorbox&quot;</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span>
         <span class="na">tal:define=</span><span class="s">&quot;sponsors view/sponsors;&quot;</span>
         <span class="na">tal:condition=</span><span class="s">&quot;sponsors&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2&gt;</span>We ❤ our sponsors<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">tal:repeat=</span><span class="s">&quot;level sponsors&quot;</span>
             <span class="na">tal:attributes=</span><span class="s">&quot;id python:&#39;level-&#39; + level&quot;</span>
             <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">tal:content=</span><span class="s">&quot;python: level.capitalize()&quot;</span><span class="nt">&gt;</span>
                Gold
            <span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;tal:images</span> <span class="na">tal:define=</span><span class="s">&quot;items python:sponsors[level];&quot;</span>
                        <span class="na">tal:repeat=</span><span class="s">&quot;item items&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sponsor&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span>
                       <span class="na">tal:attributes=</span><span class="s">&quot;href python:item[&#39;url&#39;];</span>
<span class="s">                                       title python:item[&#39;title&#39;];&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">tal:replace=</span><span class="s">&quot;structure python:item[&#39;tag&#39;]&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/tal:images&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>There already is some css in <code class="docutils literal"><span class="pre">browser/static/ploneconf.css</span></code> to make it look ok.</p>
<div class="highlight-css"><div class="highlight"><pre><span class="nc">.sponsor</span> <span class="p">{</span>
    <span class="k">float</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="m">1em</span> <span class="m">1em</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.sponsor</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">8px</span> <span class="m">#000000</span><span class="p">;</span>
    <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">8px</span> <span class="m">#000000</span><span class="p">;</span>
    <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">8px</span> <span class="m">#000000</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Turn the a content type speaker from <a class="reference internal" href="dexterity.html#dexterity1-excercises-label"><span>Exercise 2 of the first chapter on dexterity</span></a> into a python-based type.</p>
<p>Is should hold the following fields:</p>
<ul class="simple">
<li>title</li>
<li>email</li>
<li>homepage</li>
<li>biography</li>
<li>company</li>
<li>twitter_name</li>
<li>irc_name</li>
<li>image</li>
</ul>
<p>Do <em>not</em> use the IBasic or IDublinCore behavior to add title and description. Instead add your own field <code class="docutils literal"><span class="pre">title</span></code> and give it the title <em>Name</em>.</p>
<div class="toggle admonition">
<p class="first admonition-title">Solution</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">plone.app.textfield</span> <span class="kn">import</span> <span class="n">RichText</span>
<span class="kn">from</span> <span class="nn">plone.app.vocabularies.catalog</span> <span class="kn">import</span> <span class="n">CatalogSource</span>
<span class="kn">from</span> <span class="nn">plone.autoform</span> <span class="kn">import</span> <span class="n">directives</span>
<span class="kn">from</span> <span class="nn">plone.namedfile</span> <span class="kn">import</span> <span class="n">field</span> <span class="k">as</span> <span class="n">namedfile</span>
<span class="kn">from</span> <span class="nn">plone.supermodel</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">ploneconf.site</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">z3c.relationfield.schema</span> <span class="kn">import</span> <span class="n">RelationChoice</span>
<span class="kn">from</span> <span class="nn">z3c.relationfield.schema</span> <span class="kn">import</span> <span class="n">RelationList</span>
<span class="kn">from</span> <span class="nn">zope</span> <span class="kn">import</span> <span class="n">schema</span>


<span class="k">class</span> <span class="nc">ISpeaker</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dexterity-Schema for Speaker</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;First Name&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">last_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Last Name&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;E-Mail&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">homepage</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">URI</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Homepage&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">biography</span> <span class="o">=</span> <span class="n">RichText</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Biography&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">company</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Company&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">twitter_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Twitter-Name&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">irc_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;IRC-Name&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">namedfile</span><span class="o">.</span><span class="n">NamedBlobImage</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Image&#39;</span><span class="p">),</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Register the type in <code class="docutils literal"><span class="pre">profiles/default/types.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;portal_types&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Plone Types Tool&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Controls the available contenttypes in your portal<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;talk&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;sponsor&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span><span class="nt">/&gt;</span>
<span class="hll"> <span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;speaker&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span><span class="nt">/&gt;</span>
</span> <span class="c">&lt;!-- -*- more types can be added here -*- --&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>The FTI goes in <code class="docutils literal"><span class="pre">profiles/default/types/speaker.xml</span></code>. Again we use <code class="docutils literal"><span class="pre">Item</span></code> as the base-class:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;speaker&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Dexterity FTI&quot;</span> <span class="na">i18n:domain=</span><span class="s">&quot;plone&quot;</span>
   <span class="na">xmlns:i18n=</span><span class="s">&quot;http://xml.zope.org/namespaces/i18n&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Speaker<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">i18n:translate=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;icon_expr&quot;</span><span class="nt">&gt;</span>string:${portal_url}/document_icon.png<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;factory&quot;</span><span class="nt">&gt;</span>speaker<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_view_expr&quot;</span><span class="nt">&gt;</span>string:${folder_url}/++add++speaker<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;link_target&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;immediate_view&quot;</span><span class="nt">&gt;</span>view<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;global_allow&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;filter_content_types&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;allowed_content_types&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;allow_discussion&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default_view&quot;</span><span class="nt">&gt;</span>view<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;view_methods&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;view&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default_view_fallback&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_permission&quot;</span><span class="nt">&gt;</span>cmf.AddPortalContent<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;klass&quot;</span><span class="nt">&gt;</span>plone.dexterity.content.Item<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IBasic&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">&gt;</span>ploneconf.site.content.speaker.ISpeaker<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;model_source&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;model_file&quot;</span><span class="nt">&gt;&lt;/property&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;schema_policy&quot;</span><span class="nt">&gt;</span>dexterity<span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;(Default)&quot;</span> <span class="na">to=</span><span class="s">&quot;(dynamic view)&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;edit&quot;</span> <span class="na">to=</span><span class="s">&quot;@@edit&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;sharing&quot;</span> <span class="na">to=</span><span class="s">&quot;@@sharing&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;view&quot;</span> <span class="na">to=</span><span class="s">&quot;(selected layout)&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;action</span> <span class="na">title=</span><span class="s">&quot;View&quot;</span> <span class="na">action_id=</span><span class="s">&quot;view&quot;</span> <span class="na">category=</span><span class="s">&quot;object&quot;</span> <span class="na">condition_expr=</span><span class="s">&quot;&quot;</span>
    <span class="na">description=</span><span class="s">&quot;&quot;</span> <span class="na">icon_expr=</span><span class="s">&quot;&quot;</span> <span class="na">link_target=</span><span class="s">&quot;&quot;</span> <span class="na">url_expr=</span><span class="s">&quot;string:${object_url}&quot;</span>
    <span class="na">visible=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;permission</span> <span class="na">value=</span><span class="s">&quot;View&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/action&gt;</span>
 <span class="nt">&lt;action</span> <span class="na">title=</span><span class="s">&quot;Edit&quot;</span> <span class="na">action_id=</span><span class="s">&quot;edit&quot;</span> <span class="na">category=</span><span class="s">&quot;object&quot;</span> <span class="na">condition_expr=</span><span class="s">&quot;&quot;</span>
    <span class="na">description=</span><span class="s">&quot;&quot;</span> <span class="na">icon_expr=</span><span class="s">&quot;&quot;</span> <span class="na">link_target=</span><span class="s">&quot;&quot;</span>
    <span class="na">url_expr=</span><span class="s">&quot;string:${object_url}/edit&quot;</span> <span class="na">visible=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;permission</span> <span class="na">value=</span><span class="s">&quot;Modify portal content&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p class="last">After reinstalling the package the new type is usable.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The text and illustrations in this website are licensed by the Plone Foundation under a Creative Commons Attribution 4.0 International license..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>